"use strict";var re=Object.create;var b=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var de=(e,t)=>{for(var s in t)b(e,s,{get:t[s],enumerable:!0})},q=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ae(t))!ue.call(e,r)&&r!==s&&b(e,r,{get:()=>t[r],enumerable:!(n=oe(t,r))||n.enumerable});return e};var x=(e,t,s)=>(s=e!=null?re(ie(e)):{},q(t||!e||!e.__esModule?b(s,"default",{value:e,enumerable:!0}):s,e)),ce=e=>q(b({},"__esModule",{value:!0}),e);var fe={};de(fe,{app:()=>h});module.exports=ce(fe);var I=x(require("express")),te=x(require("mongoose")),ne=x(require("cors")),v=x(require("body-parser"));var $=require("express");var _=require("mongoose"),pe=new _.Schema({email:String,picture:String,name:String,id_google:String,creationDate:Date,updateDate:Date,locale:String,given_name:String,family_name:String,wage:Number}),g=(0,_.model)("Users",pe);var S=x(require("jsonwebtoken"));function E(e){return S.default.sign(e,"admin",{expiresIn:"1d"})}var U=async(e,t)=>{try{let{id_google:s}=e.body;if(!await g.findOne({id_google:s}))return t.status(201).json({checkUser:!1});t.status(201).json({checkUser:!0})}catch{}},N=async(e,t,s)=>{try{let n=await g.find();return t.status(200).json(n)}catch(n){return t.status(500).json({error:n})}},k=async(e,t,s)=>{let{email:n,picture:r,name:a,id_google:l,locale:m,given_name:o,family_name:i}=e.body;try{if(await g.findOne({id_google:l}))throw"user already exists";return await g.create({email:n,picture:r,name:a,id_google:l,locale:m,given_name:o,family_name:i,creationDate:new Date,updateDate:new Date,wage:0}),t.status(201).json({message:"Person added!"})}catch(d){return t.status(500).json({error:d})}},C=async(e,t)=>{let{id_google:s}=e.body;try{let n=await g.findOne({id_google:s});if(!n)throw"email of user is not correct";let r=E({sub:n._id,id_google:n.id_google});return t.status(201).send({person:n,token:r})}catch(n){return t.status(500).json({error:n})}},F=async(e,t)=>{let{user_id:s,wage:n}=e.body;try{if(console.log(n,"wage"),console.log(s,"user_id "),!n)return t.status(500).json({error:"wage required"});if(!s)return t.status(500).json({error:"user required"});let r=await g.findOneAndUpdate({_id:s},{wage:n}),a=await g.findOne({_id:s});return t.status(201).send({people:a})}catch{return t.status(500).json({error:"err"})}};var O=x(require("jsonwebtoken"));var le=async(e,t)=>{let s=String(e?.headers?.token||"");if(s)O.default.verify(s,"admin",async(n,r)=>{if(n)return t.status(403).json({message:n.message,error:n});if(!await g.findOne({_id:r?.sub}))return t.status(403).json({messagem:"forBidden"});e.headers.user=r?.sub});else return t.status(401).json({messagem:"Unauthorized"})},u=le;function A(e){e.get("/user/getall",N),e.post("/user/check",U),e.post("/user/register",k),e.post("/user/login",C),e.post("/user/save/wage",F),e.post("/token",u)}var j=require("mongoose"),me=new j.Schema({description:String,value:Number,date:Date,paymentConditions:String,paidGain:Boolean,category:String,observation:String,qtdInstallments:Number,valueRecurrence:Number,id_user:String}),c=(0,j.model)("Gain",me);var B=async(e,t)=>{let{id:s,data:n}=e.body;try{u(e,t);let r=await c.findByIdAndUpdate(s,n),a=await c.findById(s);return t.status(201).json(a)}catch(r){return t.status(500).json({error:r})}},P=async(e,t)=>{let{id:s}=e.body;try{u(e,t);let n=await c.findById(s);if(!n?._id)return t.status(500).json({error:"Ganho n\xE3o encontrado"});let r=await c.deleteOne({_id:s}),a=await c.find({id_user:n?.id_user});return t.status(201).json(a)}catch(n){return t.status(500).json({error:n})}},L=async(e,t)=>{let{id_user:s}=e.body;try{u(e,t);let n=await c.find({id_user:s});return t.status(201).json(n)}catch(n){return t.status(500).json({error:n})}},W=async(e,t)=>{try{u(e,t);let{id:s}=e.body,n=await c.findOne({_id:s});return t.status(201).json(n)}catch(s){return t.status(500).json({error:s})}},H=async(e,t,s)=>{u(e,t);let{description:n,value:r,date:a,paymentConditions:l,paidGain:m,category:o,observation:i,id_user:d,valueRecurrence:y,qtdInstallments:f}=e.body;if(!n||!r||!a||!l||!d)return t.status(500).json({error:"H\xE1 obrigatorios campos n\xE3o preenchidos"});o||(o="no information"),i||(i=""),i||(i=""),m||(m=!1),y||(y=0),f||(f=0);try{return await c.create({description:n,value:r,date:a,paymentConditions:l,paidGain:m,id_user:d,valueRecurrence:y,qtdInstallments:f}),t.status(201).json({message:"Ganho criado com sucesso!"})}catch(R){return t.status(500).json({error:R})}};function T(e){e.get("/gain/all",L),e.post("/gain/get",W),e.put("/gain/update",B),e.delete("/gain/delete",P),e.post("/gain/create",H)}var G=require("mongoose"),ge=new G.Schema({description:String,value:Number,date:Date,paymentConditions:String,expensePayment:Boolean,category:String,local:String,qtdInstallments:Number,buyer:String,observation:String,id_goal:String,id_user:String,valueRecurrence:Number}),p=(0,G.model)("Expense",ge);var z=async(e,t)=>{let{id:s,data:n}=e.body;try{u(e,t);let r=await p.findByIdAndUpdate(s,n),a=await p.findById(s);return t.status(201).json(a)}catch(r){return t.status(500).json({error:r})}},Y=async(e,t)=>{let{id:s}=e.body;try{u(e,t);let n=await p.findById(s);if(!n?._id)return t.status(500).json({error:"Gasto n\xE3o encontrado"});let r=await p.deleteOne({_id:s}),a=await p.find({id_user:n?.id_user});return t.status(201).json(a)}catch(n){return t.status(500).json({error:n})}},J=async(e,t)=>{let{id_user:s}=e.body;try{u(e,t);let n=await p.find({id_user:s});return t.status(201).json(n)}catch(n){return t.status(500).json({error:n})}},K=async(e,t)=>{try{u(e,t);let{id:s}=e.body,n=await p.findOne({_id:s});return t.status(201).json(n)}catch(s){return t.status(500).json({error:s})}},Q=async(e,t,s)=>{u(e,t);let{description:n,value:r,date:a,paymentConditions:l,expensePayment:m,category:o,local:i,qtdInstallments:d,buyer:y,observation:f,id_goal:R,id_user:M,valueRecurrence:D}=e.body;if(!n||!r||!a||!l||!M||m===void 0)return t.status(500).json({error:"H\xE1 obrigatorios campos n\xE3o preenchidos"});D||(D=0),o||(o="no information"),f||(f=""),i||(f=""),R||(R=""),y||(y=""),d||(d=0);try{return await p.create({description:n,value:r,date:a,paymentConditions:l,expensePayment:m,category:o,local:i,qtdInstallments:d,buyer:y,observation:f,id_goal:R,id_user:M,valueRecurrence:D}),t.status(201).json({message:"Gasto cadastrado com sucesso!"})}catch(se){return t.status(500).json({error:se})}};function V(e){e.post("/expense/all",J),e.get("/expense/get",K),e.put("/expense/update",z),e.delete("/expense/delete",Y),e.post("/expense/create",Q)}var X=async(e,t)=>{let{id_user:s,date:n}=e.body;try{u(e,t),console.log(s,"id_userid_user");let r=[];n||(n=new Date);let a=new Date(n);if(!s)return t.status(500).json({error:"user required"});let l=await c.find({id_user:s}),m=await p.find({id_user:s});return l.forEach((o,i)=>{if(o.paymentConditions==="Despesa recorrente"){r.push(o);return}if(new Date(o.date).getMonth()==a.getMonth()){r.push(o);return}if(o.paymentConditions==="Parcelado"&&o.qtdInstallments){let d=new Date(o.date);if(d.setMonth(d.getMonth()+o.qtdInstallments),new Date(o.date).getMonth()<=a.getMonth()&&d.getMonth()>=a.getMonth()){r.push(o);return}}}),m.forEach(o=>{if(o.paymentConditions==="Despesa recorrente"){r.push(o);return}if(new Date(o.date).getMonth()==a.getMonth()){r.push(o);return}if(o.paymentConditions==="Parcelado"&&o.qtdInstallments){let i=new Date(o.date);if(i.setMonth(i.getMonth()+o.qtdInstallments),new Date(o.date).getMonth()<=a.getMonth()&&i.getMonth()>=a.getMonth()){r.push(o);return}}}),t.status(201).json(r.sort((o,i)=>new Date(o.date).getMilliseconds()-new Date(i.date).getMilliseconds()))}catch(r){return t.status(500).json({error:r})}};function Z(e){e.post("/generalList/all",X)}var w=(0,$.Router)();function ee(){return A(w),T(w),V(w),Z(w),w}var h=(0,I.default)();h.use((0,ne.default)());h.use(I.default.json());h.use(v.default.urlencoded({extended:!0}));h.use(v.default.json());h.use(ee());te.default.connect("mongodb+srv://admin:12345@moon.p6ongcq.mongodb.net/?retryWrites=true&w=majority").then(()=>{console.log("mongoDB conection is working"),h.listen(9002)}).catch(e=>console.log(e,"deu erro :( (miado)"));0&&(module.exports={app});
