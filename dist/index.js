"use strict";var se=Object.create;var b=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var ue=(e,t)=>{for(var s in t)b(e,s,{get:t[s],enumerable:!0})},S=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of oe(t))!ie.call(e,r)&&r!==s&&b(e,r,{get:()=>t[r],enumerable:!(n=re(t,r))||n.enumerable});return e};var x=(e,t,s)=>(s=e!=null?se(ae(e)):{},S(t||!e||!e.__esModule?b(s,"default",{value:e,enumerable:!0}):s,e)),de=e=>S(b({},"__esModule",{value:!0}),e);var ge={};ue(ge,{app:()=>h});module.exports=de(ge);var I=x(require("express")),ee=x(require("mongoose")),te=x(require("cors")),M=x(require("body-parser"));var Z=require("express");var j=require("mongoose"),ce=new j.Schema({email:String,picture:String,name:String,id_google:String,creationDate:Date,updateDate:Date,locale:String,given_name:String,family_name:String,wage:Number}),f=(0,j.model)("Users",ce);var q=x(require("jsonwebtoken"));function E(e){return q.default.sign(e,"admin",{expiresIn:"1d"})}var U=async(e,t)=>{try{let{id_google:s}=e.body;if(!await f.findOne({id_google:s}))return t.status(201).json({checkUser:!1});t.status(201).json({checkUser:!0})}catch{}},N=async(e,t,s)=>{try{let n=await f.find();return t.status(200).json(n)}catch(n){return t.status(500).json({error:n})}},k=async(e,t,s)=>{let{email:n,picture:r,name:a,id_google:m,locale:l,given_name:o,family_name:i}=e.body;try{if(await f.findOne({id_google:m}))throw"user already exists";return await f.create({email:n,picture:r,name:a,id_google:m,locale:l,given_name:o,family_name:i,creationDate:new Date,updateDate:new Date,wage:0}),t.status(201).json({message:"Person added!"})}catch(d){return t.status(500).json({error:d})}},C=async(e,t)=>{let{id_google:s}=e.body;try{let n=await f.findOne({id_google:s});if(!n)throw"email of user is not correct";let r=E({sub:n._id,id_google:n.id_google});return t.status(201).send({person:n,token:r})}catch(n){return t.status(500).json({error:n})}};var F=x(require("jsonwebtoken"));var pe=async(e,t)=>{let s=String(e?.headers?.token||"");if(s)F.default.verify(s,"admin",async(n,r)=>{if(n)return t.status(403).json({message:n.message,error:n});if(!await f.findOne({_id:r?.sub}))return t.status(403).json({messagem:"forBidden"});e.headers.user=r?.sub});else return t.status(401).json({messagem:"Unauthorized"})},u=pe;function B(e){e.get("/user/getall",N),e.post("/user/check",U),e.post("/user/register",k),e.post("/user/login",C),e.post("/token",u)}var _=require("mongoose"),me=new _.Schema({description:String,value:Number,date:Date,paymentConditions:String,paidGain:Boolean,category:String,observation:String,qtdInstallments:Number,valueRecurrence:Number,id_user:String}),c=(0,_.model)("Gain",me);var A=async(e,t)=>{let{id:s,data:n}=e.body;try{u(e,t);let r=await c.findByIdAndUpdate(s,n),a=await c.findById(s);return t.status(201).json(a)}catch(r){return t.status(500).json({error:r})}},O=async(e,t)=>{let{id:s}=e.body;try{u(e,t);let n=await c.findById(s);if(!n?._id)return t.status(500).json({error:"Ganho n\xE3o encontrado"});let r=await c.deleteOne({_id:s}),a=await c.find({id_user:n?.id_user});return t.status(201).json(a)}catch(n){return t.status(500).json({error:n})}},P=async(e,t)=>{let{id_user:s}=e.body;try{u(e,t);let n=await c.find({id_user:s});return t.status(201).json(n)}catch(n){return t.status(500).json({error:n})}},L=async(e,t)=>{try{u(e,t);let{id:s}=e.body,n=await c.findOne({_id:s});return t.status(201).json(n)}catch(s){return t.status(500).json({error:s})}},H=async(e,t,s)=>{u(e,t);let{description:n,value:r,date:a,paymentConditions:m,paidGain:l,category:o,observation:i,id_user:d,valueRecurrence:y,qtdInstallments:g}=e.body;if(!n||!r||!a||!m||!d)return t.status(500).json({error:"H\xE1 obrigatorios campos n\xE3o preenchidos"});o||(o="no information"),i||(i=""),i||(i=""),l||(l=!1),y||(y=0),g||(g=0);try{return await c.create({description:n,value:r,date:a,paymentConditions:m,paidGain:l,id_user:d,valueRecurrence:y,qtdInstallments:g}),t.status(201).json({message:"Ganho criado com sucesso!"})}catch(R){return t.status(500).json({error:R})}};function T(e){e.get("/gain/all",P),e.post("/gain/get",L),e.put("/gain/update",A),e.delete("/gain/delete",O),e.post("/gain/create",H)}var G=require("mongoose"),le=new G.Schema({description:String,value:Number,date:Date,paymentConditions:String,expensePayment:Boolean,category:String,local:String,qtdInstallments:Number,buyer:String,observation:String,id_goal:String,id_user:String,valueRecurrence:Number}),p=(0,G.model)("Expense",le);var z=async(e,t)=>{let{id:s,data:n}=e.body;try{u(e,t);let r=await p.findByIdAndUpdate(s,n),a=await p.findById(s);return t.status(201).json(a)}catch(r){return t.status(500).json({error:r})}},W=async(e,t)=>{let{id:s}=e.body;try{u(e,t);let n=await p.findById(s);if(!n?._id)return t.status(500).json({error:"Gasto n\xE3o encontrado"});let r=await p.deleteOne({_id:s}),a=await p.find({id_user:n?.id_user});return t.status(201).json(a)}catch(n){return t.status(500).json({error:n})}},Y=async(e,t)=>{let{id_user:s}=e.body;try{u(e,t);let n=await p.find({id_user:s});return t.status(201).json(n)}catch(n){return t.status(500).json({error:n})}},J=async(e,t)=>{try{u(e,t);let{id:s}=e.body,n=await p.findOne({_id:s});return t.status(201).json(n)}catch(s){return t.status(500).json({error:s})}},K=async(e,t,s)=>{u(e,t);let{description:n,value:r,date:a,paymentConditions:m,expensePayment:l,category:o,local:i,qtdInstallments:d,buyer:y,observation:g,id_goal:R,id_user:v,valueRecurrence:D}=e.body;if(!n||!r||!a||!m||!v||l===void 0)return t.status(500).json({error:"H\xE1 obrigatorios campos n\xE3o preenchidos"});D||(D=0),o||(o="no information"),g||(g=""),i||(g=""),R||(R=""),y||(y=""),d||(d=0);try{return await p.create({description:n,value:r,date:a,paymentConditions:m,expensePayment:l,category:o,local:i,qtdInstallments:d,buyer:y,observation:g,id_goal:R,id_user:v,valueRecurrence:D}),t.status(201).json({message:"Gasto cadastrado com sucesso!"})}catch(ne){return t.status(500).json({error:ne})}};function Q(e){e.post("/expense/all",Y),e.get("/expense/get",J),e.put("/expense/update",z),e.delete("/expense/delete",W),e.post("/expense/create",K)}var V=async(e,t)=>{let{id_user:s,date:n}=e.body;try{u(e,t),console.log(s,"id_userid_user");let r=[];n||(n=new Date);let a=new Date(n);if(!s)return t.status(500).json({error:"user required"});let m=await c.find({id_user:s}),l=await p.find({id_user:s});return m.forEach((o,i)=>{if(o.paymentConditions==="Despesa recorrente"){r.push(o);return}if(new Date(o.date).getMonth()==a.getMonth()){r.push(o);return}if(o.paymentConditions==="Parcelado"&&o.qtdInstallments){let d=new Date(o.date);if(d.setMonth(d.getMonth()+o.qtdInstallments),new Date(o.date).getMonth()<=a.getMonth()&&d.getMonth()>=a.getMonth()){r.push(o);return}}}),l.forEach(o=>{if(o.paymentConditions==="Despesa recorrente"){r.push(o);return}if(new Date(o.date).getMonth()==a.getMonth()){r.push(o);return}if(o.paymentConditions==="Parcelado"&&o.qtdInstallments){let i=new Date(o.date);if(i.setMonth(i.getMonth()+o.qtdInstallments),new Date(o.date).getMonth()<=a.getMonth()&&i.getMonth()>=a.getMonth()){r.push(o);return}}}),t.status(201).json(r.sort((o,i)=>new Date(o.date).getMilliseconds()-new Date(i.date).getMilliseconds()))}catch(r){return t.status(500).json({error:r})}};function X(e){e.post("/generalList/all",V)}var w=(0,Z.Router)();function $(){return B(w),T(w),Q(w),X(w),w}var h=(0,I.default)();h.use((0,te.default)());h.use(I.default.json());h.use(M.default.urlencoded({extended:!0}));h.use(M.default.json());h.use($());ee.default.connect("mongodb+srv://admin:12345@moon.p6ongcq.mongodb.net/?retryWrites=true&w=majority").then(()=>{console.log("mongoDB conection is working"),h.listen(9002)}).catch(e=>console.log(e,"deu erro :( (miado)"));0&&(module.exports={app});
